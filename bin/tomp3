#!/bin/bash
set -e

main() {
    local ffmpeg="ffmpeg"
    if [ -z "$1" ]; then
        echo "Usage: $0 FILE [FILE...]"
        exit 1
    fi
    if ! command -v ffmpeg > /dev/null; then
        ffmpeg="avconv"
    fi
    for file in "$@"; do
      pushd $(dirname "$file") > /dev/null
      local base=$(basename "$file")
      local output="${base%.*}.mp3"
      if [ -e "$output" ]; then
        echo "Skipping $file - output file $output already exists!"
        continue
      fi
      echo "Converting $file to $output"
      $ffmpeg -i "$file" -vn -f mp3 "$output"
      popd > /dev/null
    done
}

main "$@"
